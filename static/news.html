<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïò§Î•¥Îã§ - Í≥ºÍ±∞ Îâ¥Ïä§ Î∂ÑÏÑù</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; color: #333; }
        .layout { display: flex; min-height: 100vh; }
        .sidebar { width: 260px; background: white; border-right: 1px solid #e9ecef; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        .logo-section { background: linear-gradient(135deg, #FF6B6B 0%, #FF5252 100%); color: white; padding: 1.5rem; text-align: center; }
        .logo { font-size: 1.8rem; font-weight: bold; margin-bottom: 0.5rem; }
        .logo-subtitle { font-size: 0.9rem; opacity: 0.9; }
        .nav-menu { padding: 1.5rem 0; }
        .nav-item { padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s ease; border-left: 4px solid transparent; display: flex; align-items: center; gap: 0.8rem; }
        .nav-item:hover { background-color: #f8f9fa; border-left-color: #FF6B6B; }
        .nav-item.active { background-color: #fff3f3; border-left-color: #FF6B6B; color: #FF6B6B; font-weight: 600; }
        .nav-icon { font-size: 1.1rem; width: 20px; }
        .main-content { flex: 1; padding: 2rem; overflow-y: auto; }
        .page-header { background: white; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .breadcrumb { color: #6c757d; font-size: 0.9rem; margin-bottom: 0.5rem; }
        .page-title { font-size: 2rem; font-weight: 700; color: #2c3e50; margin-bottom: 0.5rem; }
        .page-subtitle { color: #6c757d; font-size: 1.1rem; line-height: 1.6; }
        .search-filter-section { background: white; border-radius: 12px; padding: 1.5rem 2rem; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .search-controls { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 300px; position: relative; }
        .search-input { width: 100%; padding: 0.8rem 1rem 0.8rem 2.5rem; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; }
        .search-input:focus { outline: none; border-color: #FF6B6B; }
        .search-icon { position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); color: #6c757d; }
        .filter-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .filter-btn { padding: 0.6rem 1.2rem; border: 2px solid #e9ecef; background: white; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; }
        .filter-btn:hover { border-color: #FF6B6B; }
        .filter-btn.active { background: #FF6B6B; color: white; border-color: #FF6B6B; }
        .news-section { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .section-title { font-size: 1.4rem; font-weight: 600; color: #2c3e50; }
        .news-list { display: flex; flex-direction: column; gap: 1rem; }
        .news-item { border: 1px solid #e9ecef; border-radius: 8px; padding: 1.5rem; transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: flex-start; gap: 1.5rem; }
        .news-item:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); border-color: #FF6B6B; }
        .news-content { flex: 1; cursor: pointer; }
        .news-meta { display: flex; gap: 1rem; align-items: center; margin-bottom: 0.8rem; font-size: 0.9rem; color: #6c757d; flex-wrap: wrap; }
        .news-date { background: #f8f9fa; padding: 0.3rem 0.8rem; border-radius: 15px; }
        /* ‚ñº‚ñº‚ñº Ïπ¥ÌÖåÍ≥†Î¶¨(ÏÇ∞ÏóÖ) Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä ‚ñº‚ñº‚ñº */
        .news-industry { background: #e3f2fd; color: #1976d2; padding: 0.3rem 0.8rem; border-radius: 15px; font-weight: 500; }
        .news-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.8rem; line-height: 1.4; color: #2c3e50; }
        .news-summary { color: #6c757d; line-height: 1.6; }
        .news-actions { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
        .bookmark-star { font-size: 1.8rem; color: #ced4da; cursor: pointer; transition: all 0.2s ease-in-out; }
        .bookmark-star:hover { transform: scale(1.2); }
        .bookmark-star.bookmarked { color: #FFC107; }
        .btn-analyze { background: #FF6B6B; color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-analyze:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: white; max-width: 800px; max-height: 90vh; overflow-y: auto; padding: 2rem; border-radius: 12px; margin: 1rem; position: relative; }
        .modal-close-btn { position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
        .modal-title { margin: 0 2rem 1.5rem 0; color: #333; font-size: 1.5rem; }
        .modal-section { margin-bottom: 1.5rem; }
        .modal-section-title { margin-bottom: 0.8rem; color: #333; font-size: 1.1rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 0.5rem; }
        .modal-text-box { background: #f8f9fa; padding: 1rem; border-radius: 8px; line-height: 1.6; max-height: 200px; overflow-y: auto; }
        .modal-highlight-box { background: #e8f5e8; padding: 1rem; border-radius: 8px; line-height: 1.6; }
        .modal-footer { margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee; font-size: 0.9rem; color: #666; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 0.5rem; margin-top: 2rem; }
        .page-btn { padding: 0.6rem 1rem; border: 1px solid #e9ecef; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; }
        .page-btn:hover { border-color: #FF6B6B; }
        .page-btn.active { background: #FF6B6B; color: white; border-color: #FF6B6B; }
        .loading { text-align: center; padding: 3rem; color: #6c757d; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #FF6B6B; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="layout">
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">Ïò§Î•¥Îã§</div>
                <div class="logo-subtitle">Ìà¨Ïûê ÌïôÏäµ ÌîåÎû´Ìèº</div>
            </div>
            <div class="nav-menu">
                <div class="nav-item" onclick="navigateTo('home')"><span class="nav-icon"></span><span>Home</span></div>
                <div class="nav-item" onclick="navigateTo('mypage')"><span class="nav-icon"></span><span>My Page</span></div>
                <div class="nav-item active" onclick="navigateTo('news')"><span class="nav-icon"></span><span>News</span></div>
                <div class="nav-item" onclick="navigateTo('sector')"><span class="nav-icon"></span><span>Sector</span></div>
                <div class="nav-item" onclick="navigateTo('company')"><span class="nav-icon"></span><span>Company</span></div>
                <div class="nav-item" onclick="navigateTo('game')"><span class="nav-icon"></span><span>Game</span></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="page-header" style="text-align: center;">
                <h1 class="page-title"> Í≥ºÍ±∞ Îâ¥Ïä§ Î∂ÑÏÑù</h1>
                <p class="page-subtitle">Í≥ºÍ±∞Ïùò Ï£ºÏöî Í≤ΩÏ†ú/ÏÇ∞ÏóÖ Ïù¥ÏäàÎì§ÏùÑ ÌôïÏù∏ÌïòÍ≥† Ìà¨Ïûê Ïù∏ÏÇ¨Ïù¥Ìä∏Î•º ÏñªÏñ¥Î≥¥ÏÑ∏Ïöî.</p>
            </div>
            
            <div class="search-filter-section">
                <div class="search-controls">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="search-input" placeholder="Îâ¥Ïä§ Ï†úÎ™©, ÎÇ¥Ïö©, ÌÇ§ÏõåÎìú Í≤ÄÏÉâ...">
                    </div>
                </div>
            </div>
            
            <div class="news-section">
                <div class="section-header">
                    <h2 class="section-title">Îâ¥Ïä§ Î™©Î°ù (<span id="news-count">0</span>Í∞ú)</h2>
                </div>
                <div class="news-list" id="news-container"></div>
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
    </div>
    
    <div id="news-analysis-modal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeNewsAnalysisModal()" class="modal-close-btn">&times;</button>
            <h2 id="modal-news-title" class="modal-title"></h2>
            <div class="modal-section">
                <h3 class="modal-section-title"> ÏõêÎ≥∏ Îâ¥Ïä§ ÎÇ¥Ïö©</h3>
                <div id="modal-news-content" class="modal-text-box"></div>
            </div>
            <div class="modal-section">
                <h3 class="modal-section-title"> AI Î∂ÑÏÑù Í¥ÄÎ†® ÏÇ∞ÏóÖ</h3>
                <div id="modal-related-industries" class="modal-highlight-box"></div>
            </div>
            <div class="modal-section">
                <h3 class="modal-section-title"> AI Î∂ÑÏÑù ÏÇ∞ÏóÖ ÏòÅÌñ•</h3>
                <div id="modal-industry-analysis" class="modal-highlight-box" style="background: #fff8e1;"></div>
            </div>
             <div class="modal-section">
                <h3 class="modal-section-title"> Í∑ºÍ±∞ ÏûêÎ£å</h3>
                <div id="modal-evidence" class="modal-text-box"></div>
            </div>
            <div class="modal-footer">
                <span id="modal-analysis-timestamp"></span>
            </div>
        </div>
    </div>
    
    <script>
        let allNewsData = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        document.addEventListener('DOMContentLoaded', function() {
            loadPastNewsFromDatabase();
            setupEventListeners();
        });

        async function loadPastNewsFromDatabase(searchTerm = '') {
            showLoadingState();
            try {
                const url = searchTerm ? `/api/news/past?search=${encodeURIComponent(searchTerm)}&limit=200` : '/api/news/past?limit=200';
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const result = await response.json();
                if (result.success && Array.isArray(result.data)) {
                    allNewsData = result.data;
                    currentPage = 1;
                    renderPage(currentPage);
                    showNotification(`Ï¥ù ${allNewsData.length}Í∞úÏùò Í≥ºÍ±∞ Ïù¥ÏäàÎ•º Î°úÎìúÌñàÏäµÎãàÎã§.`, 'success');
                } else {
                    throw new Error('API ÏùëÎãµ ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('Í≥ºÍ±∞ Îâ¥Ïä§ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                showErrorState('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                showNotification('Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        function renderPage(page) {
            currentPage = page;
            const container = document.getElementById('news-container');
            const paginatedData = allNewsData.slice((page - 1) * itemsPerPage, page * itemsPerPage);
            container.innerHTML = '';
            if (paginatedData.length === 0) {
                showEmptyState();
            } else {
                 const bookmarkedIssues = JSON.parse(localStorage.getItem('bookmarkedIssues')) || [];
                paginatedData.forEach(item => {
                    const isBookmarked = bookmarkedIssues.some(b => b.id === item.id);
                    container.appendChild(createNewsListItem(item, isBookmarked));
                });
            }
            updateNewsCount(allNewsData.length);
            updatePagination();
        }

        function createNewsListItem(news, isBookmarked) {
            const item = document.createElement('div');
            item.className = 'news-item';
            const title = news.title || 'Ï†úÎ™© ÏóÜÏùå';
            const summary = news.summary || 'ÏöîÏïΩ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.';
            const category = news.related_industries || 'Ïπ¥ÌÖåÍ≥†Î¶¨ ÏóÜÏùå';
            const dateInfo = formatDatePeriod(news.start_date, news.end_date);
            item.innerHTML = `
                <div class="news-content" onclick="showNewsAnalysisModal('${news.id}')">
                    <div class="news-meta">
                        <div class="news-date">${dateInfo}</div>
                        <div class="news-industry">${category}</div>
                    </div>
                    <h3 class="news-title">${title}</h3>
                    <p class="news-summary">${summary}</p>
                </div>
                <div class="news-actions">
                    <div class="bookmark-star ${isBookmarked ? 'bookmarked' : ''}" onclick="bookmarkNews(this, '${news.id}')">
                        ${isBookmarked ? '‚òÖ' : '‚òÜ'}
                    </div>
                    <button class="action-btn btn-analyze" onclick="showNewsAnalysisModal('${news.id}')">ÏÉÅÏÑ∏ Î∂ÑÏÑù</button>
                </div>
            `;
            return item;
        }

        // --- ‚ñº‚ñº‚ñº ÌïµÏã¨ ÏàòÏ†ï Î∂ÄÎ∂Ñ: ÏÉÅÏÑ∏ Î∂ÑÏÑù Î™®Îã¨ Í∏∞Îä• ‚ñº‚ñº‚ñº ---
        async function showNewsAnalysisModal(newsId) {
            const news = allNewsData.find(n => String(n.id) === String(newsId));
            if (!news) return;

            const modal = document.getElementById('news-analysis-modal');
            const industriesDiv = document.getElementById('modal-related-industries');
            const analysisDiv = document.getElementById('modal-industry-analysis');

            // 1. Í∏∞Î≥∏ Ï†ïÎ≥¥ Î®ºÏ†Ä ÌëúÏãú
            document.getElementById('modal-news-title').textContent = news.title || 'Ï†úÎ™© ÏóÜÏùå';
            document.getElementById('modal-news-content').innerHTML = (news.content || 'ÎÇ¥Ïö© ÏóÜÏùå').replace(/\n/g, '<br>');
            document.getElementById('modal-evidence').textContent = news.evidence_source || 'Í∑ºÍ±∞ ÏûêÎ£å Ï†ïÎ≥¥ ÏóÜÏùå';
            document.getElementById('modal-analysis-timestamp').textContent = `Ïù¥Ïäà Í∏∞Í∞Ñ: ${formatDatePeriod(news.start_date, news.end_date)}`;
            
            // 2. Î™®Îã¨ÏùÑ ÎùÑÏö∞Í≥† AI Î∂ÑÏÑù ÏÑπÏÖòÏóê Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
            industriesDiv.innerHTML = `<div class="loading"><div class="spinner"></div><p>AIÍ∞Ä Í¥ÄÎ†® ÏÇ∞ÏóÖÏùÑ Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</p></div>`;
            analysisDiv.innerHTML = `<div class="loading"><div class="spinner"></div><p>AIÍ∞Ä ÏÇ∞ÏóÖ ÏòÅÌñ•ÏùÑ Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</p></div>`;
            modal.style.display = 'flex';

            // 3. simulation_apiÏóê AI Î∂ÑÏÑù ÏöîÏ≤≠
            try {
                const response = await fetch('/api/simulation/analyze_industries', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        issue_name: news.title,
                        issue_description: news.content || news.summary 
                    })
                });

                if (!response.ok) throw new Error(`ÏÑúÎ≤Ñ Î∂ÑÏÑù Ïò§Î•ò: ${response.status}`);
                const result = await response.json();
                if (!result.success || !result.data || !result.data.industries) {
                    throw new Error('AI Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }
                
                // 4. ÏÑ±Í≥µ Ïãú, Î∂ÑÏÑù Í≤∞Í≥ºÎ°ú Î™®Îã¨ ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                const industries = result.data.industries;
                
                industriesDiv.innerHTML = industries.map(ind => 
                    `<p><strong>- ${ind.industry_name || 'N/A'}</strong></p>`
                ).join('');

                analysisDiv.innerHTML = industries.map(ind => 
                    `<p><strong>[${ind.industry_name || 'N/A'}]</strong> ${ind.reason || 'Î∂ÑÏÑù ÎÇ¥Ïö© ÏóÜÏùå'}</p>`
                ).join('<hr style="border:0; border-top:1px solid #eee; margin: 0.5rem 0;">');

            } catch (error) {
                console.error("AI ÏÇ∞ÏóÖ Î∂ÑÏÑù Ïã§Ìå®:", error);
                industriesDiv.innerHTML = `<p style="color:red;">Í¥ÄÎ†® ÏÇ∞ÏóÖ Î∂ÑÏÑùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</p>`;
                analysisDiv.innerHTML = `<p style="color:red;">ÏÇ∞ÏóÖ ÏòÅÌñ• Î∂ÑÏÑùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</p>`;
            }
        }

        function closeNewsAnalysisModal() {
            document.getElementById('news-analysis-modal').style.display = 'none';
        }

        function setupEventListeners() {
            const searchInput = document.getElementById('search-input');
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => { loadPastNewsFromDatabase(e.target.value); }, 500);
            });
             document.getElementById('news-analysis-modal').addEventListener('click', function(e) {
                if (e.target === this) closeNewsAnalysisModal();
            });
        }
        function updateNewsCount(count) { document.getElementById('news-count').textContent = count; }
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            const totalPages = Math.ceil(allNewsData.length / itemsPerPage);
            if (totalPages <= 1) return;
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4);
            pagination.insertAdjacentHTML('beforeend', `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Äπ</button>`);
            for (let i = startPage; i <= endPage; i++) {
                pagination.insertAdjacentHTML('beforeend', `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`);
            }
            pagination.insertAdjacentHTML('beforeend', `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>‚Ä∫</button>`);
        }
        function changePage(page) {
            const totalPages = Math.ceil(allNewsData.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;
            renderPage(page);
        }
        function bookmarkNews(element, newsId) {
            event.stopPropagation();
            const newsToBookmark = allNewsData.find(n => String(n.id) === String(newsId));
            if (!newsToBookmark) return;
            let bookmarkedIssues = JSON.parse(localStorage.getItem('bookmarkedIssues')) || [];
            const existingIndex = bookmarkedIssues.findIndex(b => b.id === newsToBookmark.id);
            if (existingIndex > -1) {
                bookmarkedIssues.splice(existingIndex, 1);
                element.innerHTML = '‚òÜ';
                element.classList.remove('bookmarked');
                showNotification(`'${newsToBookmark.title}' Î∂ÅÎßàÌÅ¨Î•º Ìï¥Ï†úÌñàÏäµÎãàÎã§.`, 'info');
            } else {
                bookmarkedIssues.push(newsToBookmark);
                element.innerHTML = '‚òÖ';
                element.classList.add('bookmarked');
                showNotification(`'${newsToBookmark.title}' Ïù¥ÏäàÎ•º Ï†ÄÏû•ÌñàÏäµÎãàÎã§!`, 'success');
            }
            localStorage.setItem('bookmarkedIssues', JSON.stringify(bookmarkedIssues));
        }
        function formatDatePeriod(startDate, endDate) {
            const format = (dateStr) => {
                if (!dateStr || dateStr === 'ÌòÑÏû¨') return dateStr;
                try {
                    const date = new Date(dateStr);
                    return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
                } catch { return dateStr; }
            };
            const start = format(startDate);
            const end = format(endDate);
            return (end && start !== end) ? `${start} ~ ${end}` : start;
        }
        function showLoadingState() { document.getElementById('news-container').innerHTML = `<div class="loading"><div class="spinner"></div><p>Í≥ºÍ±∞ Ïù¥ÏäàÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p></div>`; }
        function showEmptyState() { document.getElementById('news-container').innerHTML = `<div class="loading"><p>Ìï¥Îãπ Ï°∞Í±¥Ïóê ÎßûÎäî Îâ¥Ïä§Í∞Ä ÏóÜÏäµÎãàÎã§.</p></div>`; }
        function showErrorState(message) { document.getElementById('news-container').innerHTML = `<div class="loading"><p style="color:#dc3545;">${message}</p></div>`; }
        function showNotification(message, type = 'info') { /* ÏÉùÎûµ */ }
        function navigateTo(page) {
            const pages = {
                'home': '/static/index.html', 'mypage': '/static/mypage.html',
                'news': '/static/news.html', 'sector': '/static/sector.html',
                'company': '/static/company.html', 'game': '/static/game.html'
            };
            if (pages[page] && window.location.pathname !== pages[page]) {
                window.location.href = pages[page];
            }
        }
    </script>
</body>
</html>